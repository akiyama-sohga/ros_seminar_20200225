<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type"><style type="text/css">ol{margin:0;padding:0}table td,table th{padding:0}.c1{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:14pt;font-family:"Arial";font-style:normal}.c2{color:#999999;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:14pt;font-family:"Arial";font-style:normal}.c0{padding-top:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:left}.c5{font-weight:400;text-decoration:none;vertical-align:baseline;font-family:"Arial";font-style:normal}.c6{background-color:#ffffff;max-width:697.9pt;padding:72pt 72pt 72pt 72pt}.c4{color:#cc0000;font-size:14pt}.c8{color:#666666}.c3{height:11pt}.c7{font-size:14pt}.title{padding-top:0pt;color:#000000;font-size:26pt;padding-bottom:3pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.subtitle{padding-top:0pt;color:#666666;font-size:15pt;padding-bottom:16pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}li{color:#000000;font-size:11pt;font-family:"Arial"}p{margin:0;color:#000000;font-size:11pt;font-family:"Arial"}h1{padding-top:20pt;color:#000000;font-size:20pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h2{padding-top:18pt;color:#000000;font-size:16pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h3{padding-top:16pt;color:#434343;font-size:14pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h4{padding-top:14pt;color:#666666;font-size:12pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h5{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h6{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;font-style:italic;orphans:2;widows:2;text-align:left}</style></head><body class="c6"><p class="c0"><span class="c2">#!/usr/bin/env python</span></p><p class="c0 c3"><span class="c5 c7 c8"></span></p><p class="c0"><span class="c1">from __future__ import print_function</span></p><p class="c0 c3"><span class="c1"></span></p><p class="c0"><span class="c1">import roslib; roslib.load_manifest(&#39;teleop_twist_keyboard&#39;)</span></p><p class="c0"><span class="c1">import rospy</span></p><p class="c0 c3"><span class="c1"></span></p><p class="c0"><span class="c1">from geometry_msgs.msg import Twist</span></p><p class="c0"><span class="c5 c4">from std_msgs.msg import Empty</span></p><p class="c0 c3"><span class="c1"></span></p><p class="c0"><span class="c1">import sys, select, termios, tty</span></p><p class="c0 c3"><span class="c1"></span></p><p class="c0"><span class="c7">msg = </span><span class="c2">&quot;&quot;&quot;</span></p><p class="c0"><span class="c2">Reading from the keyboard &nbsp;and Publishing to Twist!</span></p><p class="c0"><span class="c2">---------------------------</span></p><p class="c0"><span class="c2">Moving around:</span></p><p class="c0"><span class="c2">&nbsp; &nbsp;u &nbsp; &nbsp;i &nbsp; &nbsp;o</span></p><p class="c0"><span class="c2">&nbsp; &nbsp;j &nbsp; &nbsp;k &nbsp; &nbsp;l</span></p><p class="c0"><span class="c2">&nbsp; &nbsp;m &nbsp; &nbsp;, &nbsp; &nbsp;.</span></p><p class="c0 c3"><span class="c2"></span></p><p class="c0"><span class="c2">For Holonomic mode (strafing), hold down the shift key:</span></p><p class="c0"><span class="c2">---------------------------</span></p><p class="c0"><span class="c2">&nbsp; &nbsp;U &nbsp; &nbsp;I &nbsp; &nbsp;O</span></p><p class="c0"><span class="c2">&nbsp; &nbsp;J &nbsp; &nbsp;K &nbsp; &nbsp;L</span></p><p class="c0"><span class="c2">&nbsp; &nbsp;M &nbsp; &nbsp;&lt; &nbsp; &nbsp;&gt;</span></p><p class="c0 c3"><span class="c2"></span></p><p class="c0"><span class="c2">t : up (+z)</span></p><p class="c0"><span class="c2">b : down (-z)</span></p><p class="c0 c3"><span class="c2"></span></p><p class="c0"><span class="c2">anything else : stop</span></p><p class="c0 c3"><span class="c2"></span></p><p class="c0"><span class="c2">q/z : increase/decrease max speeds by 10%</span></p><p class="c0"><span class="c2">w/x : increase/decrease only linear speed by 10%</span></p><p class="c0"><span class="c2">e/c : increase/decrease only angular speed by 10%</span></p><p class="c0 c3"><span class="c2"></span></p><p class="c0"><span class="c2">CTRL-C to quit</span></p><p class="c0"><span class="c2">&quot;&quot;&quot;</span></p><p class="c0 c3"><span class="c1"></span></p><p class="c0"><span class="c1">moveBindings = {</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &#39;i&#39;:(1,0,0,0),</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &#39;o&#39;:(1,0,0,-1),</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &#39;j&#39;:(0,0,0,1),</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &#39;l&#39;:(0,0,0,-1),</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &#39;u&#39;:(1,0,0,1),</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &#39;,&#39;:(-1,0,0,0),</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &#39;.&#39;:(-1,0,0,1),</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &#39;m&#39;:(-1,0,0,-1),</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &#39;O&#39;:(1,-1,0,0),</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &#39;I&#39;:(1,0,0,0),</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &#39;J&#39;:(0,1,0,0),</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &#39;L&#39;:(0,-1,0,0),</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &#39;U&#39;:(1,1,0,0),</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &#39;&lt;&#39;:(-1,0,0,0),</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &#39;&gt;&#39;:(-1,-1,0,0),</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &#39;M&#39;:(-1,1,0,0),</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &#39;t&#39;:(0,0,1,0),</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &#39;b&#39;:(0,0,-1,0),</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; }</span></p><p class="c0 c3"><span class="c1"></span></p><p class="c0"><span class="c1">speedBindings={</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &#39;q&#39;:(1.1,1.1),</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &#39;z&#39;:(.9,.9),</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &#39;w&#39;:(1.1,1),</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &#39;x&#39;:(.9,1),</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &#39;e&#39;:(1,1.1),</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &#39;c&#39;:(1,.9),</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; }</span></p><p class="c0 c3"><span class="c1"></span></p><p class="c0"><span class="c5 c4">flying_mode = False</span></p><p class="c0 c3"><span class="c1"></span></p><p class="c0"><span class="c1">def getKey():</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; tty.setraw(sys.stdin.fileno())</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; select.select([sys.stdin], [], [], 0)</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; key = sys.stdin.read(1)</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; termios.tcsetattr(sys.stdin, termios.TCSADRAIN, settings)</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; return key</span></p><p class="c0 c3"><span class="c1"></span></p><p class="c0 c3"><span class="c1"></span></p><p class="c0"><span class="c1">def vels(speed,turn):</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; return &quot;currently:\tspeed %s\tturn %s &quot; % (speed,turn)</span></p><p class="c0 c3"><span class="c1"></span></p><p class="c0"><span class="c1">if __name__==&quot;__main__&quot;:</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; settings = termios.tcgetattr(sys.stdin)</span></p><p class="c0 c3"><span class="c1"></span></p><p class="c0"><span class="c7">&nbsp; &nbsp; pub = rospy.Publisher(&#39;</span><span class="c4">/bebop/</span><span class="c1">cmd_vel&#39;, Twist, queue_size = 1)</span></p><p class="c0"><span class="c5 c4">&nbsp; &nbsp; pubTakeoff = rospy.Publisher(&#39;/bebop/takeoff&#39;, Empty, queue_size=10)</span></p><p class="c0"><span class="c5 c4">&nbsp; &nbsp; pubLand = rospy.Publisher(&#39;/bebop/land&#39;, Empty, queue_size=10)</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; </span></p><p class="c0"><span class="c1">&nbsp; &nbsp; rospy.init_node(&#39;teleop_twist_keyboard&#39;)</span></p><p class="c0 c3"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &nbsp; speed = rospy.get_param(&quot;~speed&quot;, 0.5)</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; turn = rospy.get_param(&quot;~turn&quot;, 1.0)</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; x = 0</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; y = 0</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; z = 0</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; th = 0</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; status = 0</span></p><p class="c0 c3"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &nbsp; try:</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; print(msg)</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; print(vels(speed,turn))</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; while(1):</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; key = getKey()</span></p><p class="c0"><span class="c4 c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if key == &#39; &#39;:</span></p><p class="c0"><span class="c5 c4">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if flying_mode:</span></p><p class="c0"><span class="c5 c4">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; flying_mode = False</span></p><p class="c0"><span class="c5 c4">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pubLand.publish(Empty())</span></p><p class="c0"><span class="c5 c4">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else:</span></p><p class="c0"><span class="c5 c4">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; flying_mode = True</span></p><p class="c0"><span class="c5 c4">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pubTakeoff.publish(Empty())</span></p><p class="c0"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; el</span><span class="c1">if key in moveBindings.keys():</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; x = moveBindings[key][0]</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; y = moveBindings[key][1]</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; z = moveBindings[key][2]</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; th = moveBindings[key][3]</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; elif key in speedBindings.keys():</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; speed = speed * speedBindings[key][0]</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; turn = turn * speedBindings[key][1]</span></p><p class="c0 c3"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print(vels(speed,turn))</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (status == 14):</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; print(msg)</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; status = (status + 1) % 15</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; else:</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; x = 0</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; y = 0</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; z = 0</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; th = 0</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (key == &#39;\x03&#39;):</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; break</span></p><p class="c0 c3"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; twist = Twist()</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; twist.linear.x = x*speed; twist.linear.y = y*speed; twist.linear.z = z*speed;</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; twist.angular.x = 0; twist.angular.y = 0; twist.angular.z = th*turn</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pub.publish(twist)</span></p><p class="c0 c3"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &nbsp; except Exception as e:</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; print(e)</span></p><p class="c0 c3"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &nbsp; finally:</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; twist = Twist()</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; twist.linear.x = 0; twist.linear.y = 0; twist.linear.z = 0</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; twist.angular.x = 0; twist.angular.y = 0; twist.angular.z = 0</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; pub.publish(twist)</span></p><p class="c0 c3"><span class="c1"></span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; termios.tcsetattr(sys.stdin, termios.TCSADRAIN, settings)</span></p></body></html>